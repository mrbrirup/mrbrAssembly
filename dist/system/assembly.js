/*mrbrAssembly 
Copyright 2019 Martin Ruppersburg
Licensed under MIT (https://github.com/mrbrirup/mrbrAssembly/blob/master/licence.md)*/var Mrbr=Mrbr||{};Mrbr.System=Mrbr.System||{},Mrbr.System.Assembly=class{constructor(){Mrbr.System.Assembly._fileReplacements=[{replace:new RegExp("^Mrbr\\."),with:"/"},{replace:new RegExp("\\.","g"),with:"/"}]}static toObject(...e){let t=Mrbr.System.Assembly.defaultContext;const r=e.length,s=e[r-1],n=Mrbr.System.Assembly.objectCache;let o;if(o=1===r?t:e[0],void 0!==n[s]&&void 0!==n[s].mrbrAssemblyTypeName)return n[s];const l=e[r-1].split(".");let a=o;for(let e,t=0,r=l.length;t<r;t++)void 0===a[e=l[t]]&&(a[e]={}),a=a[e];return n[s]=a}static get defaultContext(){return Mrbr.System.Assembly._defaultContext}static set defaultContext(e){Mrbr.System.Assembly._defaultContext=e}static get objectCache(){return Mrbr.System.Assembly._objectCache}static isObject(...e){return void 0!==ObjectUtils.toObject(...e)}static fetchFile(...e){const t=Mrbr.System.Assembly,r=Mrbr.System.Assembly.getFileLoadParameters(e),s=t.loader;let n;return assemblyLoadedFile=t.loadedFile,null!==(n=t.isLoadInProgress(r.url))?n:new Promise((e,n)=>{s[r.url]={promise:prm,result:void 0,loaded:!1},fetch(r.formattedUrl,{method:"GET"}).then(o=>o.text().then(n=>{s[r.url].result=n,s[r.url].loaded=!0,delete s[r.url].promise;const o={url:r.url,text:n};n=void 0===t._fileInterceptor?assemblyLoadedFile(o):t.fileInterceptor.intercept(assemblyLoadedFile,void 0,o)[1],r.formattedUrl!==r.url&&(s[r.formattedUrl]=s[r.url]),e(n)}).catch(function(e){n(e)})).catch(function(e){n(e)})})}static isLoadInProgress(e){const t=Mrbr.System.Assembly.loader;if(t.hasOwnProperty(e)){let r=t[e];return!0===r.loaded?Promise.resolve():r.promise}return null}static getFileLoadParameters(...e){let t,r,s,n,o=e[0];if("string"==typeof o)r=o,s=t=o;else if("object"==typeof o)t=o.url,s=o.formatUrl?o.formatUrl:t,r=o.alias?o.alias:t,n=o.headers;else{if(!Mrbr.System.Object.typeMatch(o,"Mrbr.System.ManifestEntry"))throw"Unknown class entry request";r=o.alias,s=o.formatUrl,t=o.url,n=o.headers}return{url:t,fileAlias:r,formattedUrl:s,headers:n}}static loadXmlHttpFile(...e){const t=Mrbr.System.Assembly;let r;const s=t.loader,n=t.getFileLoadParameters(e);return null!==(r=t.isLoadInProgress(n.url))?r:new Promise((e,r)=>{s[n.url]={promise:prm,result:void 0,loaded:!1};const o=new XMLHttpRequest;o.open("GET",n.url,!0),o.send(""),o.onreadystatechange=function(){if(4===o.readyState)if(o.status>=200&&o.status<300){s[n.url].result=o.responseText,s[n.url].loaded=!0,delete s[url].promise;const r={url:url,text:o.responseText},l=void 0===t._fileInterceptor?assemblyLoadedFile(r):t.fileInterceptor.intercept(assemblyLoadedFile,void 0,r)[1];n.formattedUrl!==n.url&&(s[n.formattedUrl]=s[n.url]),e(l)}else r(new Error(o.statusText))}})}static loadFile(e){}static loadFiles(e){if(void 0===e)return Promise.resolve();Array.isArray(e)||(e=[e]);const t=e.length,r=new Array(t),s=Mrbr.System.Assembly.loadFile;for(let n=0;n<t;n++)r[n]=s(e[n]);return Promise.all(r)}static get typePropertyName(){return"mrbrAssemblyTypeName"}static addTypeNameScript(e){const t=Mrbr.System.Assembly;return`\nObject.defineProperty(${e}.prototype, '${t.typePropertyName}', { get: function() {return ${e}.${t.typePropertyName};}});\n${e}.${t.typePropertyName} = "${e}";`}static get fileReplacements(){return Mrbr.System.Assembly._fileReplacements}static set fileReplacements(e){Mrbr.System.Assembly._fileReplacements=e}static resolveNamespaceToFile(e){let t=e;for(let e,r=0,s=Mrbr.System.Assembly._fileReplacements,n=s.length;r<n;r++)e=s[r],t=`${t.split(e.replace).join(e.with)}`;return t}static nop(){}static setArrayPolyFills(){Object.getOwnPropertyDescriptor(Array.prototype,"distinct")||(Array.prototype.distinct=function(){return this.filter((e,t,r)=>r.indexOf(e)===t)}),Array.prototype.tokenSort=function(){return this.sort(function(e,t){return e.start-t.start})},Mrbr.System.Assembly.setArrayPolyFills=Mrbr.System.Assembly.nop}static get loader(){return Mrbr.System.Assembly._loader}static loadComponent(...e){let t,r,s=!1;const n=e[0];if("string"==typeof n)r=n,t=n;else if("object"==typeof n)t=n.entryName,r=n.alias?n.alias:n.entryName;else{if(!Mrbr.System.Object.typeMatch(n,"Mrbr.System.ManifestEntry"))throw"Unknown component entry request";r=n.alias,t=n.entryName,s=!0}const o=Mrbr.System.Assembly,l=o.toObject,a=Mrbr.System.Assembly.resolveNamespaceToFile,i=(o.loadClasses,o.setInheritance,o.addClassCtor,o.loadManifest,o.createComponent);let c=a(t)+".js";return new Promise(function(e,a){let m;s?(n.url=c,n.alias=r,m=n):m=new Mrbr.System.ManifestEntry(Mrbr.System.ManifestEntry.FileTypes.Component,t,r,c),o.loadFile(m).then(function(s){if(!(l(t)instanceof Function)){const e={componentName:t,result:s,assembly:o,assemblyToObject:l};void 0===o._componentInterceptor?i(e):o.componentInterceptor.intercept(i,void 0,e)}if(!(l(r)instanceof Function)){const e={componentName:r,result:s,assembly:o,assemblyToObject:l};void 0===o._componentInterceptor?i(e):o.componentInterceptor.intercept(i,void 0,e)}e()}).catch(function(e){a(e)})})}static createClass(...e){const t=e[0],r=t.className,s=t.result,n=t.assembly,o=t.assemblyToObject;Function(`${r} = ${s};\n${n.addTypeNameScript(r)};\n`)(),n.objectCache[r]=o(r)}static createComponent(...e){const t=e[0],r=t.componentName,s=t.result,n=t.assembly,o=t.assemblyToObject;Function(`${r} = ${s};\ncustomElements.define('${r.toLowerCase().split(".").join("-")}', ${r});`)(),n.objectCache[r]=o(r)}static createScript(...e){const t=e[0].scriptText;Function(t)()}static loadedFile(...e){return e[0].text}static createScriptElement(...e){const t=e[0],r=t.fileName,s=t.scriptText;let n=document.createElement("script");return n.id=r,n.text=s,document.head.appendChild(n),src}static createStyle(...e){const t=e[0],r=t.url,s=t.cssText;let n=document.createElement("style");return n.id=r,n.type="text/css",n.styleSheet?n.styleSheet.cssText=s:n.appendChild(document.createTextNode(s)),document.head.appendChild(n),n}static createLinkedStyle(...e){const t=e[0].url;let r=document.createElement("link");return r.id=t,r.type="text/css",r.rel="stylesheet",r.href=t,document.head.appendChild(r),r}static createConfig(...e){const t=e[0].configText;return assembly.loader[configFileName].config=JSON.parse(t),assembly.loader[configFileName].config}static get classInterceptor(){return Mrbr.System.Assembly._classInterceptor}static set classInterceptor(e){Mrbr.System.Assembly._classInterceptor=e}static get componentInterceptor(){return Mrbr.System.Assembly._componentInterceptor}static set componentInterceptor(e){Mrbr.System.Assembly._componentInterceptor=e}static get scriptInterceptor(){return Mrbr.System.Assembly._scriptInterceptor}static set scriptInterceptor(e){Mrbr.System.Assembly._scriptInterceptor=e}static get fileInterceptor(){return Mrbr.System.Assembly._fileInterceptor}static set fileInterceptor(e){Mrbr.System.Assembly._fileInterceptor=e}static get scriptElementInterceptor(){return Mrbr.System.Assembly._scriptElementInterceptor}static set scriptElementInterceptor(e){Mrbr.System.Assembly._scriptElementInterceptor=e}static get styleInterceptor(){return Mrbr.System.Assembly._styleInterceptor}static set styleInterceptor(e){Mrbr.System.Assembly._styleInterceptor=e}static get linkedStyleInterceptor(){return Mrbr.System.Assembly._linkedStyleInterceptor}static set linkedStyleInterceptor(e){Mrbr.System.Assembly._linkedStyleInterceptor=e}static get configInterceptor(){return Mrbr.System.Assembly._configInterceptor}static set configInterceptor(e){Mrbr.System.Assembly._configInterceptor=e}static loadClass(...e){const t=e[0];let r,s,n=!1;if("string"==typeof t)r=t,s=t;else if("object"==typeof t)s=t.entryName,r=t.alias?t.alias:t.entryName;else{if(!Mrbr.System.Object.typeMatch(t,"Mrbr.System.ManifestEntry"))throw"Unknown class entry request";r=t.alias,s=t.entryName,n=!0}let o=[s],l=s;const a=Mrbr.System.Assembly,i=a.toObject,c=Mrbr.System.Assembly.resolveNamespaceToFile,m=a.loadClasses,y=a.setInheritance,d=a.addClassCtor,p=a.loadManifest,b=a.createClass;return l=c(s)+".js",new Promise(function(e,c){let u;n?(t.url=l,t.alias=r,u=t):u=void 0!==Mrbr.System.ManifestEntry?new Mrbr.System.ManifestEntry(Mrbr.System.ManifestEntry.FileTypes.Class,s,r,l):{fileType:"class",entryName:s,alias:r,url:l,formatUrl:l.toLowerCase()},a.loadFile(u).then(function(e){let t;if(!((t=i(s))instanceof Function)){const t={className:s,result:e,assembly:a,assemblyToObject:i};void 0===a._classInterceptor?b(t):a.classInterceptor.intercept(b,void 0,t)}if(!((t=i(r))instanceof Function)){const t={className:r,result:e,assembly:a,assemblyToObject:i};void 0===a._classInterceptor?b(t):a.classInterceptor.intercept(b,void 0,t)}}).catch(function(e){e instanceof Error&&c({name:"Exception",error:e,source:`${a.mrbrAssemblyTypeName}:loadClass`,info:`className: ${r}`}),c(e)}).then(function(){return new Promise(function(e,t){let r=i(s).manifest;null==r||0===r.length?e():p(r).then(function(){e()}).catch(function(e){t(e)})})}).catch(function(e){c(e)}).then(function(){let t=0,r=-1,n=[];return new Promise(function(e,l){const a=i(s),c=function(){r=t;const s=[],i=[a.using,a.inherits,a.newClasses];for(let e=0,t=i.length;e<t;e++){let t=i[e];if(void 0!==t)for(let e=0,r=t.length;e<r;e++){let r=t[e];s.includes(r)||s.push(r)}}t=s.length,o=o.concat(s).distinct(),m(s).then(function(s){let o=void 0===(n=s)?0:n.length;(t+=o)!=r?c():e()}).catch(function(e){l()})};c()}).catch(function(e){c(e)}).then(function(t){const r=[];if(void 0!==o&&o.length>0)for(let e,t=0,s=o.length;t<s;t++)if((e=i(o[t]))instanceof Function){const t=new Promise(function(t,r){y(e.inherits,e).then(function(r){y(e.extends,e).then(function(r){d(e),t()})}).catch(function(e){r()})});r.push(t)}Promise.all(r).then(t=>{e()})}).catch(function(e){c(e)})})})}static loadManifest_class(){}static loadManifest_(){}static loadManifest(e){if(void 0===e)return Promise.resolve();const t=Mrbr.System.Assembly,r=Mrbr.System.ManifestEntry.FileTypes,s=t.loadClass,n=t.loadScript,o=t.loadScriptElement,l=t.loadFile,a=t.loadStyleElement,i=t.createLinkedStyleElement,c=(e=Array.isArray(e)?e:[e]).length;let m=new Array(c);for(let y,d=0;d<c;d++){let c,p;switch(y=e[d],m[d]=new Promise(function(e,t){c=e,p=t}),y.fileType){case r.Class:s(y).then(e=>c()).catch(function(e){p(e)});break;case r.Component:t.loadComponent(y).then(e=>c()).catch(function(e){p(e)});break;case r.Script:n({url:y.entryName}).then(e=>c()).catch(function(e){p(e)});break;case r.File:l({url:y.entryName}).then(e=>c()).catch(function(e){p(e)});break;case r.ScriptElement:o({url:y.entryName}).then(e=>c()).catch(function(e){p(e)});break;case r.Style:y.entryName.toLowerCase().endsWith(".css")?a({url:y.entryName.toLowerCase(),formatUrl:y.entryName.toLowerCase()}).then(e=>c()).catch(function(e){p(e)}):a({url:`${t.resolveNamespaceToFile(y.entryName)}.css`.toLowerCase(),formatUrl:`${t.resolveNamespaceToFile(y.entryName)}.css`.toLowerCase()}).then(e=>c()).catch(function(e){p(e)});break;case r.LinkedStyle:y.entryName.toLowerCase().endsWith(".css")?i({url:y.entryName.toLowerCase(),formatUrl:y.entryName.toLowerCase()}).then(e=>c()).catch(function(e){p(e)}):i({url:`${t.resolveNamespaceToFile(y.entryName)}.css`.toLowerCase(),formatUrl:`${t.resolveNamespaceToFile(y.entryName)}.css`.toLowerCase()}).then(e=>c()).catch(function(e){p(e)})}}return Promise.all(m)}static loadScript(e){const t=Mrbr.System.Assembly,r=t.createScript;return new Promise(function(s,n){const o={url:e};t.loadFile(o).then(n=>{const o={fileName:e,scriptText:n};void 0===t._scriptInterceptor?r(o):t.scriptInterceptor.intercept(r,void 0,o),s()}).catch(function(e){n(e)})})}static loadScripts(e){if(void 0===e)return Promise.resolve();e=Array.isArray(e)?e:[e];const t=this.loadFile,r=e.length,s=new Array(r);for(let e,n=0;n<r;n++)e=filenames[n],s[n]=new Promise(function(r,s){t({url:e}).then(e=>r()).catch(function(e){s(e)})});return Promise.all(s)}static get ctorTokeniser(){return this._ctorTokeniser}static set ctorTokeniser(e){this._ctorTokeniser=e}static addClassCtor(e){if(void 0!==Object.getOwnPropertyDescriptor(e.prototype,"ctor"))return e;Mrbr.System.Assembly._ctorTokeniser||(Mrbr.System.Assembly._ctorTokeniser=new Mrbr.Utils.Parser.Tokeniser(Mrbr.System.Assembly.loader[Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Utils.Parser.tokenCtor")+".json"].result));Mrbr.Utils.Parser.Tokeniser;const t=e.prototype.constructor.toString(),r=Mrbr.System.Assembly.ctorTokeniser.tokenise(t),s=Mrbr.Utils.Parser.Token,n=r.length,o=s.Groups,l=[];let a,i,c=[],m=!0,y=0,d=0,p=0,b=0,u=0,f=0,h=0,M=o.Keyword;for(;m&&y<n;)(a=r[y]).group===M&&"constructor"===a.type?m=!1:y++;m=!0;let S=o.Block;for(;m&&y<n;)(a=r[y]).group===S&&"("===a.value?(p=y,d=a.levels.parens,m=!1):y++;for(m=!0;m&&y<n;)(a=r[y]).group===S&&")"===a.value&&a.levels.parens===d?(b=y,m=!1):y++;if(b>p){for(let e=p+1;e<=b-1;e++)","===(a=r[e]).value&&a.levels.parens===d?(l.push(c.join("")),c=[]):c.push(a.value);c.length>0&&l.push(c.join(""))}for(m=!0;m&&y<n;)(a=r[y]).group===S&&"{"===a.value?(u=y,h=a.levels.braces,m=!1):y++;for(m=!0;m&&y<n;)(a=r[y]).group===S&&"}"===a.value&&a.levels.braces===h?(f=y,m=!1):y++;if(f>u&&void 0===Object.getOwnPropertyDescriptor(e.prototype,"ctor")){i=new Array(f-1);for(let e=u+1;e<=f-1;e++)i[e]=r[e].value;Object.defineProperty(e.prototype,"ctor",{value:0===l.length?Function(`\n${i.join("").trim()}\n`):Function(l,`\n${i.join("").trim()+`/* comment ctor ${e.prototype.mrbrAssemblyTypeName} */`}\n`),configurable:!1,enumerable:!0,writable:!1})}return void 0===Object.getOwnPropertyDescriptor(e.prototype,"base")&&Object.defineProperty(e.prototype,"base",{value:function(...t){void 0!==t&&0!==t.length||((t=[])[0]={}),t[0].called=t[0].called||[];const r=this,s=t[0].called,n=[],o=Mrbr.System.Assembly,l=o.toObject,a=o.callInheritance;s.push(`${e.prototype.mrbrAssemblyTypeName.split(".").join("_")}_ctor`),a(e,s,n,a,l);for(let e=0,s=n.length;e<s;e++)r[n[e]](...t)},configurable:!1,enumerable:!0,writable:!1,name:"base"}),void 0===Object.getOwnPropertyDescriptor(e.prototype,"bases")&&Object.defineProperty(e.prototype,"bases",{value:function(){if(void 0!==e.prototype._bases)return e.prototype._bases;const t=[this.constructor.mrbrAssemblyTypeName];return Mrbr.System.Assembly.listClassInheritance(t,this.constructor),e.prototype._bases=t,e.prototype._bases},configurable:!1,enumerable:!0,writable:!1,name:"bases"}),e}static callInheritance(e,t,r,s,n){const o=`${e.prototype.mrbrAssemblyTypeName.split(".").join("_")}_ctor`,l=e.inherits;if(void 0!==l&&l.length>0)for(let e=0,o=l.length;e<o;e++)s(n(l[e]),t,r,s,n);t.includes(o)||(t.push(o),r.push(o))}static listClassInheritance(e,t){const r=Mrbr.System.Assembly;if(t.inherits&&t.mrbrAssemblyTypeName)for(let s=0,n=t.inherits.length,o=t.inherits;s<n;s++){let t=o[s];e.includes(t)||(e.push(t),r.listClassInheritance(e,r.toObject(t)))}}static loadClasses(e){if(void 0===e||0===e.length)return Promise.resolve();const t=Mrbr.System.Assembly,r=e.length,s=new Array(r);e=Array.isArray(e)?e:[e];for(let n,o=0;o<r;o++)n=e[o],s[o]=new Promise(function(e,r){t.loadClass(n).then(function(t){e(n)}).catch(function(e){r(e)})});return Promise.all(s)}static loadConfigFile(...e){const t=e[0].url,r=Mrbr.System.Assembly,s=r.createConfig;return new Promise(function(e,n){const o={url:t};r.loadFile(o).then(n=>{const o={configText:n};void 0===r._configInterceptor?s(o):r.configInterceptor.intercept(s,void 0,o),r.loader[t].config=JSON.parse(n),e()}).catch(function(e){n(e)})})}static loadConfigFiles(e){if(void 0===e||0===classes.length)return Promise.resolve();e=Array.isArray(e)?e:[e];const t=Mrbr.System.Assembly,r=e.length,s=new Array(r);for(let n,o=0;o<r;o++)n=e[o],s[o]=new Promise(function(e,r){const s={url:n};t.loadConfigFile(s).then(function(t){e(s)}).catch(function(e){r(e)})});return Promise.all(s)}static loadStyleElement(...e){const t=e[0].url,r=Mrbr.System.Assembly,s=r.createStyle;return new Promise(function(e,n){const o={url:t};r.loadFile(o).then(n=>{const o={url:t,cssText:n};void 0===r._styleInterceptor?s(o):r.styleInterceptor.intercept(s,void 0,o),e()}).catch(function(e){n(e)})})}static loadStyleElements(e){if(void 0===e||0===e.length)return Promise.resolve();e=Array.isArray(e)?e:[e];const t=Mrbr.System.Assembly,r=e.length,s=new Array(r);for(let n,o=0;o<r;o++)n=e[fileNameCounter],s[fileNameCounter]=new Promise(function(e,r){const s={url:filename};t.loadStyleElement(s).then(function(t){e(s)}).catch(function(e){r(e)})});return Promise.all(s)}static loadScriptElement(...e){const t=e[0].url,r=Mrbr.System.Assembly,s=r.createScriptElement;return new Promise(function(e,n){const o={url:t};r.loadFile(o).then(n=>{const o={fileName:t,scriptText:n};void 0===r._scriptElementInterceptor?s(o):r.scriptElementInterceptor.intercept(s,void 0,o),e()}).catch(function(e){n(e)})})}static loadScriptElements(e){if(void 0===e||0===e.length)return Promise.resolve();e=Array.isArray(e)?e:[e];const t=Mrbr.System.Assembly,r=e.length,s=new Array(r);for(let e,n=0;fileNamesCounter<r;n++)e=e[n],s[n]=new Promise(function(e,r){t.loadScriptElement(filename).then(function(t){e(filename)}).catch(function(e){r(e)})});return Promise.all(s)}static createLinkedScriptElement(...e){const t=e[0].url;let r=document.createElement("script");return r.id=t,r.src=t,document.head.appendChild(r),Promise.resolve()}static createLinkedScriptElements(e){if(void 0===filenames||0===filenames.length)return Promise.resolve();const t=Mrbr.System.Assembly;e=Array.isArray(filenames)?filenames:[filenames];let r=new Array(filenames.length);for(let s=0,n=e.length,o=filenames[s];s<n;s++)r[s]=new Promise(function(e,r){t.createLinkedScriptElement(o).then(function(t){e(o)}).catch(function(e){r(e)})});return Promise.all(r)}static createLinkedStyleElement(...e){const t=e[0].url,r=Mrbr.System.Assembly,s=r.createLinkedStyle,n={url:t};return void 0===r._linkedStyleInterceptor?s(n):r.linkedStyleInterceptor.intercept(s,void 0,n),Promise.resolve()}static createLinkedStyleElements(e){if(void 0===filenames||0===filenames.length)return Promise.resolve();const t=Mrbr.System.Assembly;e=Array.isArray(filenames)?filenames:[filenames];let r=new Array(filenames.length);for(let s=0,n=e.length,o=filenames[s];s<n;s++)r[s]=new Promise(function(e,r){t.createLinkedStyleElement(o).then(function(t){e(o)}).catch(function(e){r(e)})});return Promise.all(r)}static loadInterface(e){let t=e;const r=Mrbr.System.Assembly,s=r.toObject,n=Mrbr.System.Assembly.resolveNamespaceToFile,o=r.loadClasses,l=r.loadInterfaces,a=r.loadManifest;return t=n(e),t+=".json",new Promise(function(n,i){const c={url:t};r.loadFile(c).then(function(t){let c=s(e);void 0===c.mrbrInterfaceName&&((c=Object.assign(c,JSON.parse(t))).mrbrInterfaceName=e);let m=[];c.inherits&&c.inherits.length>0&&m.push(l(c.inherits)),c.using&&c.using.length>0&&m.push(o(c.using)),c.interfaces&&c.interfaces.length>0&&m.push(l(c.interfaces)),c.manifest&&c.manifest.length>0&&m.push(a(c.manifest)),Promise.all(m).then(()=>{r.setInterfaceInheritance(c.inherits,e),n()}).catch(function(e){i(e)})})})}static loadInterfaces(e){if(void 0===e||0===e.length)return Promise.resolve();const t=Mrbr.System.Assembly;e=Array.isArray(e)?e:[e];let r=new Array(e.length);for(let s=0,n=e.length,o=e[s];s<n;s++)r[s]=new Promise(function(e,r){t.loadInterface(o).then(function(t){e(o)}).catch(function(e){r(e)})});return Promise.all(r)}static setInterfaceInheritance(e,t){if(void 0===e)return;e=Array.isArray(e)?e:[e];const r=Mrbr.System.Assembly,s=r.toObject(t);s.inherited||(s.inherited=[]);for(let t,n=0,o=e.length,l=r.toObject(t);n<o;n++)t=e[n],s.inherited.includes(t)||(s.inherited.push(t),l.inherited&&(s.inherited=s.inherited.concat(l.inherited)),l.properties&&(s.properties=Object.assign(s.properties,l.properties)),l.methods&&(s.methods=Object.assign(s.methods,l.methods)))}static setInheritance(e,t){return void 0===e?Promise.resolve():Mrbr.System.Inheritance.applyInheritance(e,t)}static initialised(e){const t=Mrbr.System.Assembly;if(e&&void 0!==e.loadFile?t.loadFile=e.loadFile:"undefined"==typeof fetch?t.loadFile=t.loadXmlHttpFile:t.loadFile=t.fetchFile,e&&e.defaultContext)t._defaultContext=e.defaultContext;else if("undefined"==typeof window)if("undefined"!=typeof globalThis)t._defaultContext=globalThis;else{if("undefined"==typeof global)throw"No global";t._defaultContext=global}else window?t._defaultContext=window:t._defaultContext=void 0;return null!=e&&void 0!==e.assemblyResolvers&&null!==e.assemblyResolvers&&(t.fileReplacements=e.assemblyResolvers),t._loader={},t._objectCache={},t.setArrayPolyFills(),new Promise(function(e,r){t.loadFiles([{url:Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Utils.Parser.tokenCtor")+".json",formatUrl:(Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Utils.Parser.tokenCtor")+".json").toLowerCase()},{url:Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Utils.Parser.Tokeniser")+".js",formatUrl:(Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Utils.Parser.Tokeniser")+".js").toLowerCase()},{url:Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.Object")+".js",formatUrl:(Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.Object")+".js").toLowerCase()},{url:Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Interceptor.Interceptor")+".js",formatUrl:(Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Interceptor.Interceptor")+".js").toLowerCase()},{url:Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.ManifestEntry")+".js",formatUrl:(Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.ManifestEntry")+".js").toLowerCase()},{url:Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.Inheritance")+".js",formatUrl:(Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.Inheritance")+".js").toLowerCase()},{url:Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.Exception")+".js",formatUrl:(Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.Exception")+".js").toLowerCase()}]).then(()=>(t.loader["Mrbr.Utils.Parser.Tokeniser"]=t.loader[Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Utils.Parser.Tokeniser")+".js"],t.loader["Mrbr.System.Object"]=t.loader[Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.Object")+".js"],t.loader["Mrbr.Interceptor.Interceptor"]=t.loader[Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Interceptor.Interceptor")+".js"],t.loader["Mrbr.System.ManifestEntry"]=t.loader[Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.ManifestEntry")+".js"],t.loader["Mrbr.System.Inheritance"]=t.loader[Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.Inheritance")+".js"],t.loader["Mrbr.System.Exception"]=t.loader[Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.System.Exception")+".js"],t.loadClass({entryName:"Mrbr.Utils.Parser.Tokeniser".toLowerCase(),alias:"Mrbr.Utils.Parser.Tokeniser"}))).then(()=>t.loadClass({entryName:"Mrbr.System.Object".toLowerCase(),alias:"Mrbr.System.Object"})).then(()=>t.loadClass({entryName:"Mrbr.Interceptor.Interceptor".toLowerCase(),alias:"Mrbr.Interceptor.Interceptor"})).then(()=>{const e=Mrbr.Interceptor.Interceptor;t._classInterceptor=new e,t._componentInterceptor=new e,t._scriptInterceptor=new e,t._fileInterceptor=new e,t._scriptElementInterceptor=new e,t._styleInterceptor=new e,t._linkedStyleInterceptor=new e,t._configInterceptor=new e}).catch(e=>console.log(e)).then(()=>t.loadClass({entryName:"Mrbr.System.ManifestEntry".toLowerCase(),alias:"Mrbr.System.ManifestEntry"})).then(()=>t.loadClass({entryName:"Mrbr.System.Inheritance".toLowerCase(),alias:"Mrbr.System.Inheritance"})).then(()=>t.loadClass({entryName:"Mrbr.System.Exception".toLowerCase(),alias:"Mrbr.System.Exception"})).then(function(){return Function(t.addTypeNameScript("Mrbr.System.Assembly"))(),t.loadClasses(t.using)}).then(function(){e()}).catch(function(e){r(e)})})}static onReady(e,t){let r,s=function(){document.removeEventListener?(document.removeEventListener("DOMContentLoaded",s),document.removeEventListener("load",s),window.removeEventListener("load",s),window.removeEventListener("DOMContentLoaded",s)):(document.detachEvent("onreadystatechange",s),window.detachEvent("onload",s),window.detachEvent("load",s),document.detachEvent("load",s)),r()};return new Promise(function(t,n){r=t,Mrbr.System.Assembly.initialised(e).then(function(){document.onreadystatechange=function(){"complete"===document.readyState&&s()},"complete"===document.readyState?t("complete"):document.addEventListener?(document.addEventListener("DOMContentLoaded",s),window.addEventListener("load",s),window.addEventListener("DOMContentLoaded",s),document.addEventListener("load",s)):(document.attachEvent("onreadystatechange",s),window.attachEvent("onload",s),document.attachEvent("load",s),window.attachEvent("load",s))})})}static createNamespaceManifest(e,t,r){if(void 0===e||void 0===t||void 0===r||0===r.length)return[];const s=r.length;let n=new Array(s),o=Mrbr.System.ManifestEntry;for(let l=0;l<s;l++)n[l]=new o(t,`${e}.${r[l]}`);return n}};