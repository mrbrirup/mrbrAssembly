/*mrbrAssembly 
Copyright 2019 Martin Ruppersburg
Licensed under MIT (https://github.com/mrbrirup/mrbrAssembly/blob/master/licence.md)*/var Mrbr=Mrbr||{};Mrbr.System=Mrbr.System||{},Mrbr.System.Assembly=class{constructor(){Mrbr.System.Assembly._fileReplacements=[{replace:new RegExp("^Mrbr\\."),with:"/"},{replace:new RegExp("\\.","g"),with:"/"}]}static toObject(...e){let t=Mrbr.System.Assembly.defaultContext;const r=e.length,n=e[r-1],s=Mrbr.System.Assembly.objectCache;if(void 0!==s[n]&&void 0!==s[n].mrbrAssemblyTypeName)return s[n];const o=e[r-1].split(".");let l=1===r?t:e[0];for(let e,t=0,r=o.length;t<r;t++)void 0===l[e=o[t]]&&(l[e]={}),l=l[e];return s[n]=l}static get defaultContext(){return Mrbr.System.Assembly._defaultContext}static set defaultContext(e){Mrbr.System.Assembly._defaultContext=e}static get objectCache(){return Mrbr.System.Assembly._objectCache}static fetchFile(...e){const t=Mrbr.System.Assembly,r=Mrbr.System.Assembly.getFileLoadParameters(e),n=t.loader;let s;return assemblyLoadedFile=t.loadedFile,null!==(s=t.isLoadInProgress(r.url))?s:new Promise((e,s)=>{n[r.url]={promise:prm,result:void 0,loaded:!1},r.formattedUrl!==r.url&&(n[r.formattedUrl]=n[r.url]),fetch(r.formattedUrl,{method:"GET"}).then(o=>o.text().then(s=>{n[r.url].result=s,n[r.url].loaded=!0,delete n[r.url].promise;const o={url:r.url,text:s};s=void 0===t._fileInterceptor?assemblyLoadedFile(o):t.fileInterceptor.intercept(assemblyLoadedFile,void 0,o)[1],e(s)}).catch(function(e){s(e)})).catch(function(e){s(e)})})}static isLoadInProgress(e){const t=Mrbr.System.Assembly.loader;if(t.hasOwnProperty(e)){let r=t[e];return!0===r.loaded?Promise.resolve():r.promise}return null}static getFileLoadParameters(...e){let t,r,n,s,o=e[0];if("string"==typeof o)r=o,n=t=o;else if("object"==typeof o)t=o.url,n=o.formatUrl?o.formatUrl:t,r=o.alias?o.alias:t,s=o.headers;else{if(!Mrbr.System.Object.typeMatch(o,"Mrbr.System.ManifestEntry"))throw"Unknown class entry request";r=o.alias,n=o.formatUrl,t=o.url,s=o.headers}return{url:t,fileAlias:r,formattedUrl:n,headers:s}}static loadXmlHttpFile(...e){const t=Mrbr.System.Assembly;let r;const n=t.loader,s=t.getFileLoadParameters(e);return null!==(r=t.isLoadInProgress(s.url))?r:new Promise((e,r)=>{n[s.url]={promise:prm,result:void 0,loaded:!1};const o=new XMLHttpRequest;o.open("GET",s.url,!0),o.send(""),o.onreadystatechange=function(){if(4===o.readyState)if(o.status>=200&&o.status<300){n[s.url].result=o.responseText,n[s.url].loaded=!0,delete n[url].promise;const r={url:url,text:o.responseText},l=void 0===t._fileInterceptor?assemblyLoadedFile(r):t.fileInterceptor.intercept(assemblyLoadedFile,void 0,r)[1];s.formattedUrl!==s.url&&(n[s.formattedUrl]=n[s.url]),e(l)}else r(new Error(o.statusText))}})}static loadFile(e){}static loadFiles(e){if(void 0===e)return Promise.resolve();Array.isArray(e)||(e=[e]);const t=e.length,r=new Array(t),n=Mrbr.System.Assembly.loadFile;for(let s=0;s<t;s++)r[s]=n(e[s]);return Promise.all(r)}static get typePropertyName(){return"mrbrAssemblyTypeName"}static addTypeNameScript(e){const t=Mrbr.System.Assembly;return`\nObject.defineProperty(${e}.prototype, '${t.typePropertyName}', { get: function() {return ${e}.${t.typePropertyName};}});\n${e}.${t.typePropertyName} = "${e}";`}static get fileReplacements(){return Mrbr.System.Assembly._fileReplacements}static set fileReplacements(e){Mrbr.System.Assembly._fileReplacements=e}static resolveNamespaceToFile(e){let t=e;for(let e,r=0,n=Mrbr.System.Assembly._fileReplacements,s=n.length;r<s;r++)e=n[r],t=`${t.split(e.replace).join(e.with)}`;return t}static nop(){}static setArrayPolyFills(){Object.getOwnPropertyDescriptor(Array.prototype,"distinct")||(Array.prototype.distinct=function(){return this.filter((e,t,r)=>r.indexOf(e)===t)}),Array.prototype.tokenSort=function(){return this.sort(function(e,t){return e.start-t.start})},Mrbr.System.Assembly.setArrayPolyFills=Mrbr.System.Assembly.nop}static get loader(){return Mrbr.System.Assembly._loader}static loadComponent(...e){let t,r,n=!1;const s=e[0];if("string"==typeof s)r=s,t=s;else if("object"==typeof s)t=s.entryName,r=s.alias?s.alias:s.entryName;else{if(!Mrbr.System.Object.typeMatch(s,"Mrbr.System.ManifestEntry"))throw"Unknown component entry request";r=s.alias,t=s.entryName,n=!0}const o=Mrbr.System.Assembly,l=o.toObject,i=Mrbr.System.Assembly.resolveNamespaceToFile,a=(o.loadClasses,o.setInheritance,o.addClassCtor,o.loadManifest,o.createComponent);let c=i(t)+".js";return new Promise(function(e,i){let m;n?(s.url=c,s.alias=r,m=s):m=new Mrbr.System.ManifestEntry(Mrbr.System.ManifestEntry.FileTypes.Component,t,r,c),o.loadFile(m).then(function(n){if(!(l(t)instanceof Function)){const e={componentName:t,result:n,assembly:o,assemblyToObject:l};void 0===o._componentInterceptor?a(e):o.componentInterceptor.intercept(a,void 0,e)}if(!(l(r)instanceof Function)){const e={componentName:r,result:n,assembly:o,assemblyToObject:l};void 0===o._componentInterceptor?a(e):o.componentInterceptor.intercept(a,void 0,e)}e()}).catch(function(e){i(e)})})}static createClass(...e){const t=e[0],r=t.className,n=t.result,s=t.assembly,o=t.assemblyToObject;Function(`${r} = ${n};\n${s.addTypeNameScript(r)};\n`)(),s.objectCache[r]=o(r)}static createComponent(...e){const t=e[0],r=t.componentName,n=t.result,s=t.assembly,o=t.assemblyToObject;Function(`${r} = ${n};\ncustomElements.define('${r.toLowerCase().split(".").join("-")}', ${r});`)(),s.objectCache[r]=o(r)}static createScript(...e){const t=e[0].scriptText;Function(t)()}static loadedFile(...e){return e[0].text}static createScriptElement(...e){const t=e[0],r=t.fileName,n=t.scriptText;let s=document.createElement("script");return s.id=r,s.text=n,document.head.appendChild(s),src}static createStyle(...e){const t=e[0],r=t.url,n=t.cssText;let s=document.createElement("style");return s.id=r,s.type="text/css",s.styleSheet?s.styleSheet.cssText=n:s.appendChild(document.createTextNode(n)),document.head.appendChild(s),s}static createLinkedStyle(...e){const t=e[0].url;let r=document.createElement("link");return r.id=t,r.type="text/css",r.rel="stylesheet",r.href=t,document.head.appendChild(r),r}static createConfig(...e){const t=e[0].configText;return assembly.loader[configFileName].config=JSON.parse(t),assembly.loader[configFileName].config}static get classInterceptor(){return Mrbr.System.Assembly._classInterceptor}static set classInterceptor(e){Mrbr.System.Assembly._classInterceptor=e}static get componentInterceptor(){return Mrbr.System.Assembly._componentInterceptor}static set componentInterceptor(e){Mrbr.System.Assembly._componentInterceptor=e}static get scriptInterceptor(){return Mrbr.System.Assembly._scriptInterceptor}static set scriptInterceptor(e){Mrbr.System.Assembly._scriptInterceptor=e}static get fileInterceptor(){return Mrbr.System.Assembly._fileInterceptor}static set fileInterceptor(e){Mrbr.System.Assembly._fileInterceptor=e}static get scriptElementInterceptor(){return Mrbr.System.Assembly._scriptElementInterceptor}static set scriptElementInterceptor(e){Mrbr.System.Assembly._scriptElementInterceptor=e}static get styleInterceptor(){return Mrbr.System.Assembly._styleInterceptor}static set styleInterceptor(e){Mrbr.System.Assembly._styleInterceptor=e}static get linkedStyleInterceptor(){return Mrbr.System.Assembly._linkedStyleInterceptor}static set linkedStyleInterceptor(e){Mrbr.System.Assembly._linkedStyleInterceptor=e}static get configInterceptor(){return Mrbr.System.Assembly._configInterceptor}static set configInterceptor(e){Mrbr.System.Assembly._configInterceptor=e}static loadClass(...e){const t=e[0];let r,n,s=!1;if("string"==typeof t)r=t,n=t;else if("object"==typeof t)n=t.entryName,r=t.alias?t.alias:t.entryName;else{if(!Mrbr.System.Object.typeMatch(t,"Mrbr.System.ManifestEntry"))throw"Unknown class entry request";r=t.alias,n=t.entryName,s=!0}let o=[n],l=n;const i=Mrbr.System.Assembly,a=i.toObject,c=Mrbr.System.Assembly.resolveNamespaceToFile,m=i.loadClasses,y=i.setInheritance,d=i.addClassCtor,u=i.loadManifest,p=i.createClass;return l=c(n)+".js",new Promise(function(e,c){let f;s?(t.url=l,t.alias=r,f=t):f=void 0!==Mrbr.System.ManifestEntry?new Mrbr.System.ManifestEntry(Mrbr.System.ManifestEntry.FileTypes.Class,n,r,l):{fileType:"class",entryName:n,alias:r,url:l,formatUrl:l.toLowerCase()},i.loadFile(f).then(function(e){let t;if(!((t=a(n))instanceof Function)){const t={className:n,result:e,assembly:i,assemblyToObject:a};void 0===i._classInterceptor?p(t):i.classInterceptor.intercept(p,void 0,t)}if(!((t=a(r))instanceof Function)){const t={className:r,result:e,assembly:i,assemblyToObject:a};void 0===i._classInterceptor?p(t):i.classInterceptor.intercept(p,void 0,t)}}).catch(function(e){e instanceof Error&&c({name:"Exception",error:e,source:`${i.mrbrAssemblyTypeName}:loadClass`,info:`className: ${r}`}),c(e)}).then(function(){return new Promise(function(e,t){let r=a(n).manifest;null==r||0===r.length?e():u(r).then(function(){e()}).catch(function(e){t(e)})})}).catch(function(e){c(e)}).then(function(){let t=0,r=-1,s=[];return new Promise(function(e,l){const i=a(n),c=function(){r=t;const n=[],a=[i.using,i.inherits,i.newClasses];for(let e=0,t=a.length;e<t;e++){let t=a[e];if(void 0!==t)for(let e=0,r=t.length;e<r;e++){let r=t[e];n.includes(r)||n.push(r)}}t=n.length,o=o.concat(n).distinct(),m(n).then(function(n){let o=void 0===(s=n)?0:s.length;(t+=o)!=r?c():e()}).catch(function(e){l()})};c()}).catch(function(e){c(e)}).then(function(t){const r=[];if(void 0!==o&&o.length>0)for(let e,t=0,n=o.length;t<n;t++)if((e=a(o[t]))instanceof Function){const t=new Promise(function(t,r){y(e.inherits,e).then(function(r){y(e.extends,e).then(function(r){d(e),t()})}).catch(function(e){r()})});r.push(t)}Promise.all(r).then(t=>{e()})}).catch(function(e){c(e)})})})}static loadManifest_class(){}static loadManifest_(){}static loadManifest(e){if(void 0===e)return Promise.resolve();const t=Mrbr.System.Assembly,r=Mrbr.System.ManifestEntry.FileTypes,n=t.loadClass,s=t.loadScript,o=t.loadScriptElement,l=t.loadFile,i=t.loadStyleElement,a=t.createLinkedStyleElement,c=(e=Array.isArray(e)?e:[e]).length;let m=new Array(c);for(let y,d=0;d<c;d++){let c,u;switch(y=e[d],m[d]=new Promise(function(e,t){c=e,u=t}),y.fileType){case r.Class:n(y).then(e=>c()).catch(function(e){u(e)});break;case r.Component:t.loadComponent(y).then(e=>c()).catch(function(e){u(e)});break;case r.Script:s({url:y.entryName}).then(e=>c()).catch(function(e){u(e)});break;case r.File:l({url:y.entryName}).then(e=>c()).catch(function(e){u(e)});break;case r.ScriptElement:o({url:y.entryName}).then(e=>c()).catch(function(e){u(e)});break;case r.Style:y.entryName.toLowerCase().endsWith(".css")?i({url:y.entryName.toLowerCase(),formatUrl:y.entryName.toLowerCase()}).then(e=>c()).catch(function(e){u(e)}):i({url:`${t.resolveNamespaceToFile(y.entryName)}.css`.toLowerCase(),formatUrl:`${t.resolveNamespaceToFile(y.entryName)}.css`.toLowerCase()}).then(e=>c()).catch(function(e){u(e)});break;case r.LinkedStyle:y.entryName.toLowerCase().endsWith(".css")?a({url:y.entryName.toLowerCase(),formatUrl:y.entryName.toLowerCase()}).then(e=>c()).catch(function(e){u(e)}):a({url:`${t.resolveNamespaceToFile(y.entryName)}.css`.toLowerCase(),formatUrl:`${t.resolveNamespaceToFile(y.entryName)}.css`.toLowerCase()}).then(e=>c()).catch(function(e){u(e)})}}return Promise.all(m)}static loadScript(e){const t=Mrbr.System.Assembly,r=t.createScript;return new Promise(function(n,s){const o={url:e};t.loadFile(o).then(s=>{const o={fileName:e,scriptText:s};void 0===t._scriptInterceptor?r(o):t.scriptInterceptor.intercept(r,void 0,o),n()}).catch(function(e){s(e)})})}static loadScripts(e){if(void 0===e)return Promise.resolve();e=Array.isArray(e)?e:[e];const t=this.loadFile,r=e.length,n=new Array(r);for(let e,s=0;s<r;s++)e=filenames[s],n[s]=new Promise(function(r,n){t({url:e}).then(e=>r()).catch(function(e){n(e)})});return Promise.all(n)}static get ctorTokeniser(){return this._ctorTokeniser}static set ctorTokeniser(e){this._ctorTokeniser=e}static addClassCtor(e){if(void 0!==Object.getOwnPropertyDescriptor(e.prototype,"ctor"))return e;Mrbr.System.Assembly._ctorTokeniser||(Mrbr.System.Assembly._ctorTokeniser=new Mrbr.Utils.Parser.Tokeniser(Mrbr.System.Assembly.loader[Mrbr.System.Assembly.resolveNamespaceToFile("Mrbr.Utils.Parser.tokenCtor")+".json"].result));Mrbr.Utils.Parser.Tokeniser;const t=e.prototype.constructor.toString(),r=Mrbr.System.Assembly.ctorTokeniser.tokenise(t),n=Mrbr.Utils.Parser.Token,s=r.length,o=n.Groups,l=[];let i,a,c=[],m=!0,y=0,d=0,u=0,p=0,f=0,b=0,h=0,S=o.Keyword;for(;m&&y<s;)(i=r[y]).group===S&&"constructor"===i.type?m=!1:y++;m=!0;let M=o.Block;for(;m&&y<s;)(i=r[y]).group===M&&"("===i.value?(u=y,d=i.levels.parens,m=!1):y++;for(m=!0;m&&y<s;)(i=r[y]).group===M&&")"===i.value&&i.levels.parens===d?(p=y,m=!1):y++;if(p>u){for(let e=u+1;e<=p-1;e++)","===(i=r[e]).value&&i.levels.parens===d?(l.push(c.join("")),c=[]):c.push(i.value);c.length>0&&l.push(c.join(""))}for(m=!0;m&&y<s;)(i=r[y]).group===M&&"{"===i.value?(f=y,h=i.levels.braces,m=!1):y++;for(m=!0;m&&y<s;)(i=r[y]).group===M&&"}"===i.value&&i.levels.braces===h?(b=y,m=!1):y++;if(b>f&&void 0===Object.getOwnPropertyDescriptor(e.prototype,"ctor")){a=new Array(b-1);for(let e=f+1;e<=b-1;e++)a[e]=r[e].value;Object.defineProperty(e.prototype,"ctor",{value:0===l.length?Function(`\n${a.join("").trim()}\n`):Function(l,`\n${a.join("").trim()+`/* comment ctor ${e.prototype.mrbrAssemblyTypeName} */`}\n`),configurable:!1,enumerable:!0,writable:!1})}return void 0===Object.getOwnPropertyDescriptor(e.prototype,"base")&&Object.defineProperty(e.prototype,"base",{value:function(...t){void 0!==t&&0!==t.length||((t=[])[0]={}),t[0].called=t[0].called||[];const r=this,n=t[0].called,s=[],o=Mrbr.System.Assembly,l=o.toObject,i=o.callInheritance;n.push(`${e.prototype.mrbrAssemblyTypeName.split(".").join("_")}_ctor`),i(e,n,s,i,l);for(let e=0,n=s.length;e<n;e++)r[s[e]](...t)},configurable:!1,enumerable:!0,writable:!1,name:"base"}),void 0===Object.getOwnPropertyDescriptor(e.prototype,"bases")&&Object.defineProperty(e.prototype,"bases",{value:function(){if(void 0!==e.prototype._bases)return e.prototype._bases;const t=[this.constructor.mrbrAssemblyTypeName];return Mrbr.System.Assembly.listClassInheritance(t,this.constructor),e.prototype._bases=t,e.prototype._bases},configurable:!1,enumerable:!0,writable:!1,name:"bases"}),e}static callInheritance(e,t,r,n,s){const o=`${e.prototype.mrbrAssemblyTypeName.split(".").join("_")}_ctor`,l=e.inherits;if(void 0!==l&&l.length>0)for(let e=0,o=l.length;e<o;e++)n(s(l[e]),t,r,n,s);t.includes(o)||(t.push(o),r.push(o))}static listClassInheritance(e,t){const r=Mrbr.System.Assembly;if(t.inherits&&t.mrbrAssemblyTypeName)for(let n=0,s=t.inherits.length,o=t.inherits;n<s;n++){let t=o[n];e.includes(t)||(e.push(t),r.listClassInheritance(e,r.toObject(t)))}}static loadClasses(e){if(void 0===e||0===e.length)return Promise.resolve();const t=Mrbr.System.Assembly,r=e.length,n=new Array(r);e=Array.isArray(e)?e:[e];for(let s,o=0;o<r;o++)s=e[o],n[o]=new Promise(function(e,r){t.loadClass(s).then(function(t){e(s)}).catch(function(e){r(e)})});return Promise.all(n)}static loadConfigFile(...e){const t=e[0].url,r=Mrbr.System.Assembly,n=r.createConfig;return new Promise(function(e,s){const o={url:t};r.loadFile(o).then(s=>{const o={configText:s};void 0===r._configInterceptor?n(o):r.configInterceptor.intercept(n,void 0,o),r.loader[t].config=JSON.parse(s),e()}).catch(function(e){s(e)})})}static loadConfigFiles(e){if(void 0===e||0===classes.length)return Promise.resolve();e=Array.isArray(e)?e:[e];const t=Mrbr.System.Assembly,r=e.length,n=new Array(r);for(let s,o=0;o<r;o++)s=e[o],n[o]=new Promise(function(e,r){const n={url:s};t.loadConfigFile(n).then(function(t){e(n)}).catch(function(e){r(e)})});return Promise.all(n)}static loadStyleElement(...e){const t=e[0].url,r=Mrbr.System.Assembly,n=r.createStyle;return new Promise(function(e,s){const o={url:t};r.loadFile(o).then(s=>{const o={url:t,cssText:s};void 0===r._styleInterceptor?n(o):r.styleInterceptor.intercept(n,void 0,o),e()}).catch(function(e){s(e)})})}static loadStyleElements(e){if(void 0===e||0===e.length)return Promise.resolve();e=Array.isArray(e)?e:[e];const t=Mrbr.System.Assembly,r=e.length,n=new Array(r);for(let s,o=0;o<r;o++)s=e[fileNameCounter],n[fileNameCounter]=new Promise(function(e,r){const n={url:filename};t.loadStyleElement(n).then(function(t){e(n)}).catch(function(e){r(e)})});return Promise.all(n)}static loadScriptElement(...e){const t=e[0].url,r=Mrbr.System.Assembly,n=r.createScriptElement;return new Promise(function(e,s){const o={url:t};r.loadFile(o).then(s=>{const o={fileName:t,scriptText:s};void 0===r._scriptElementInterceptor?n(o):r.scriptElementInterceptor.intercept(n,void 0,o),e()}).catch(function(e){s(e)})})}static loadScriptElements(e){if(void 0===e||0===e.length)return Promise.resolve();e=Array.isArray(e)?e:[e];const t=Mrbr.System.Assembly,r=e.length,n=new Array(r);for(let e,s=0;fileNamesCounter<r;s++)e=e[s],n[s]=new Promise(function(e,r){t.loadScriptElement(filename).then(function(t){e(filename)}).catch(function(e){r(e)})});return Promise.all(n)}static createLinkedScriptElement(...e){const t=e[0].url;let r=document.createElement("script");return r.id=t,r.src=t,document.head.appendChild(r),Promise.resolve()}static createLinkedScriptElements(e){if(void 0===filenames||0===filenames.length)return Promise.resolve();const t=Mrbr.System.Assembly;e=Array.isArray(filenames)?filenames:[filenames];let r=new Array(filenames.length);for(let n=0,s=e.length,o=filenames[n];n<s;n++)r[n]=new Promise(function(e,r){t.createLinkedScriptElement(o).then(function(t){e(o)}).catch(function(e){r(e)})});return Promise.all(r)}static createLinkedStyleElement(...e){const t=e[0].url,r=Mrbr.System.Assembly,n=r.createLinkedStyle,s={url:t};return void 0===r._linkedStyleInterceptor?n(s):r.linkedStyleInterceptor.intercept(n,void 0,s),Promise.resolve()}static createLinkedStyleElements(e){if(void 0===filenames||0===filenames.length)return Promise.resolve();const t=Mrbr.System.Assembly;e=Array.isArray(filenames)?filenames:[filenames];let r=new Array(filenames.length);for(let n=0,s=e.length,o=filenames[n];n<s;n++)r[n]=new Promise(function(e,r){t.createLinkedStyleElement(o).then(function(t){e(o)}).catch(function(e){r(e)})});return Promise.all(r)}static loadInterface(e){let t=e;const r=Mrbr.System.Assembly,n=r.toObject,s=Mrbr.System.Assembly.resolveNamespaceToFile,o=r.loadClasses,l=r.loadInterfaces,i=r.loadManifest;return t=s(e),t+=".json",new Promise(function(s,a){const c={url:t};r.loadFile(c).then(function(t){let c=n(e);void 0===c.mrbrInterfaceName&&((c=Object.assign(c,JSON.parse(t))).mrbrInterfaceName=e);let m=[];c.inherits&&c.inherits.length>0&&m.push(l(c.inherits)),c.using&&c.using.length>0&&m.push(o(c.using)),c.interfaces&&c.interfaces.length>0&&m.push(l(c.interfaces)),c.manifest&&c.manifest.length>0&&m.push(i(c.manifest)),Promise.all(m).then(()=>{r.setInterfaceInheritance(c.inherits,e),s()}).catch(function(e){a(e)})})})}static loadInterfaces(e){if(void 0===e||0===e.length)return Promise.resolve();const t=Mrbr.System.Assembly;e=Array.isArray(e)?e:[e];let r=new Array(e.length);for(let n=0,s=e.length,o=e[n];n<s;n++)r[n]=new Promise(function(e,r){t.loadInterface(o).then(function(t){e(o)}).catch(function(e){r(e)})});return Promise.all(r)}static setInterfaceInheritance(e,t){if(void 0===e)return;e=Array.isArray(e)?e:[e];const r=Mrbr.System.Assembly,n=r.toObject(t);n.inherited||(n.inherited=[]);for(let t,s=0,o=e.length,l=r.toObject(t);s<o;s++)t=e[s],n.inherited.includes(t)||(n.inherited.push(t),l.inherited&&(n.inherited=n.inherited.concat(l.inherited)),l.properties&&(n.properties=Object.assign(n.properties,l.properties)),l.methods&&(n.methods=Object.assign(n.methods,l.methods)))}static setInheritance(e,t){return void 0===e?Promise.resolve():Mrbr.System.Inheritance.applyInheritance(e,t)}static initialised(e){const t=Mrbr.System.Assembly;if(e&&void 0!==e.loadFile?t.loadFile=e.loadFile:"undefined"==typeof fetch?t.loadFile=t.loadXmlHttpFile:t.loadFile=t.fetchFile,e&&e.defaultContext)t._defaultContext=e.defaultContext;else if("undefined"==typeof window)if("undefined"!=typeof globalThis)t._defaultContext=globalThis;else{if("undefined"==typeof global)throw"No global";t._defaultContext=global}else window?t._defaultContext=window:t._defaultContext=void 0;return null!=e&&void 0!==e.assemblyResolvers&&null!==e.assemblyResolvers&&(t.fileReplacements=e.assemblyResolvers),t._loader={},t._objectCache={},t.setArrayPolyFills(),new Promise(function(e,r){const n=t.resolveNamespaceToFile;t.loadFiles([{url:n("Mrbr.Utils.Parser.tokenCtor")+".json",formatUrl:(n("Mrbr.Utils.Parser.tokenCtor")+".json").toLowerCase()}].concat(["Mrbr.Utils.Parser.Tokeniser","Mrbr.System.Object","Mrbr.Interceptor.Interceptor","Mrbr.System.ManifestEntry","Mrbr.System.Inheritance","Mrbr.System.Exception"].map(function(e){return{alias:e,url:n(e)+".js",formatUrl:(n(e)+".js").toLowerCase()}}))).then(()=>t.loadClass({entryName:"Mrbr.Utils.Parser.Tokeniser".toLowerCase(),alias:"Mrbr.Utils.Parser.Tokeniser"})).then(()=>t.loadClass({entryName:"Mrbr.System.Object".toLowerCase(),alias:"Mrbr.System.Object"})).then(()=>t.loadClass({entryName:"Mrbr.Interceptor.Interceptor".toLowerCase(),alias:"Mrbr.Interceptor.Interceptor"})).then(()=>{const e=Mrbr.Interceptor.Interceptor;t._classInterceptor=new e,t._componentInterceptor=new e,t._scriptInterceptor=new e,t._fileInterceptor=new e,t._scriptElementInterceptor=new e,t._styleInterceptor=new e,t._linkedStyleInterceptor=new e,t._configInterceptor=new e}).catch(e=>console.log(e)).then(()=>t.loadClass({entryName:"Mrbr.System.ManifestEntry".toLowerCase(),alias:"Mrbr.System.ManifestEntry"})).then(()=>t.loadClass({entryName:"Mrbr.System.Inheritance".toLowerCase(),alias:"Mrbr.System.Inheritance"})).then(()=>t.loadClass({entryName:"Mrbr.System.Exception".toLowerCase(),alias:"Mrbr.System.Exception"})).then(function(){return Function(t.addTypeNameScript("Mrbr.System.Assembly"))(),t.loadClasses(t.using)}).then(function(){e()}).catch(function(e){r(e)})})}static onReady(e,t){let r,n=function(){document.removeEventListener?(document.removeEventListener("DOMContentLoaded",n),document.removeEventListener("load",n),window.removeEventListener("load",n),window.removeEventListener("DOMContentLoaded",n)):(document.detachEvent("onreadystatechange",n),window.detachEvent("onload",n),window.detachEvent("load",n),document.detachEvent("load",n)),r()};return new Promise(function(t,s){r=t,Mrbr.System.Assembly.initialised(e).then(function(){document.onreadystatechange=function(){"complete"===document.readyState&&n()},"complete"===document.readyState?t("complete"):document.addEventListener?(document.addEventListener("DOMContentLoaded",n),window.addEventListener("load",n),window.addEventListener("DOMContentLoaded",n),document.addEventListener("load",n)):(document.attachEvent("onreadystatechange",n),window.attachEvent("onload",n),document.attachEvent("load",n),window.attachEvent("load",n))})})}static createNamespaceManifest(e,t,r){if(void 0===e||void 0===t||void 0===r||0===r.length)return[];const n=r.length;let s=new Array(n),o=Mrbr.System.ManifestEntry;for(let l=0;l<n;l++)s[l]=new o(t,`${e}.${r[l]}`);return s}};